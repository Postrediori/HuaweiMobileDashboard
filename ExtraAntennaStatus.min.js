javascript:let mode="";let history={"sinr":[],"rsrp":[],"rsrq":[],"rscp":[],"ecio":[]};let boxcar=125,gt=3,gw=boxcar*(gt+1),gh=30;let timerInterval;function getDocument(data,type){try{const parser=new DOMParser();const doc=parser.parseFromString(data,type);const errorNode=doc.querySelector("parsererror");if(errorNode){console.log("DOM Error: Error while parsing");return null;}return doc;}catch(err){console.log("DOM Error:",err.message);}return null;}function getXMLDocument(data){return getDocument(data,"application/xml");}function getHTMLDocument(data){return getDocument(data,"text/html");}function extractXML(tag,document){try{const tags=document.getElementsByTagName(tag);if(tags.length>0){return tags[0].innerHTML;}}catch(err){console.log("XML Error:",err.message);}return null;}function getDocumentCsrfToken(data){let doc=getHTMLDocument(data);if(!doc){console.log("Error:Cannot get Web UI page");return null;}let token=null;let metaTags=doc.getElementsByTagName("meta");for(const tag of metaTags){if(tag.getAttribute("name")==="csrf_token"){let tokenAttribute=tag.getAttribute("content");if(tokenAttribute) {token=tokenAttribute;break;}}}return token;}function getResponseStatus(doc){let tags=doc.getElementsByTagName("response");if(tags.length>0 && tags[0].innerHTML==="OK"){return 0;}else{let errtags=doc.getElementsByTagName("error");if(errtags.length>0){let err={};for(const t of errtags[0].children){err[t.nodeName]=t.innerHTML;}console.log("Error: Received responce with error:",err);}else{console.log("Error: Received responce with unknown status");}return 1;}}function formatBandwidth(bytesPerSec){const SIZE_KB=1024;const SIZE_MB=1024*1024;let bitsPerSec=bytesPerSec*8;if(bitsPerSec<SIZE_KB){return `${bitsPerSec}bit/s`;}else if(bitsPerSec<SIZE_MB){return `${(bitsPerSec/SIZE_KB).toFixed(2)}KBit/s`;}else{return `${(bitsPerSec/SIZE_MB).toFixed(2)}MBit/s`;}}function getModeDescription(mode){switch(mode){case "0":return "GSM";case "2":return "WCDMA";case "7":return "LTE";}return "Unknown mode";}function setParam(param,val){try{document.getElementById(param).innerHTML=val;}catch(param){};}function setVisible(id,visible){document.getElementById(id).style.display=visible?"block":"none";}function setColor(id,c){document.getElementById(id).style.backgroundColor=c;}function setMode(newMode){if(mode!==newMode){mode=newMode;console.log("Network mode set to", mode);setVisible("status_3g",false);setVisible("status_lte",false);if(mode==="WCDMA"){setVisible("status_3g",true);}else if(mode==="LTE"){setVisible("status_lte",true);}}}function barGraph(p,v,c,min,max){let val=v.slice(0,-c);if(val>max){val=max;}if(val<min){val=min;}history[p].unshift(val);if(history[p].length>boxcar){history[p].pop();}let html=`<svg version="1.1" viewBox="0 0 ${gw} ${gh}" width="${gw}" height="${gh}" preserveAspectRatio="xMaxYMax slice" style="border:1px solid #ccc;padding:1px;margin-top:-6px;width:${gw}px;">`;for(let x=0;x<history[p].length;x++){let pax=(gt+1)*(x+1);let pay=gh-1;let pby=gh-(history[p][x]-min)/(max-min)*gh;if(isNaN(pby)){pby = pay;}let pc=(history[p][x]-min)/(max-min)*100;let color=pc<50?"red":(pc<85?"orange":"green");html+=`<line x1="${pax}" y1="${pay}" x2="${pax}" y2="${pby}" stroke="${color}" stroke-width="${gt}"></line>`;}html+="</svg>";document.getElementById("b"+p).innerHTML=html;}function currentBand(){$.ajax({type:"GET",async:true,url:'/api/device/signal',error:function(request,status,error){console.log("Error: Cannot get Signal data:",request.status,"\nmessage:",request.responseText,"\nerror:",error);},success:function(data){const doc=getXMLDocument(data);if(doc){const currentMode=getModeDescription(extractXML("mode",doc));let report=`Network mode : ${currentMode}`;setParam("mode",currentMode);setMode(currentMode);const rssi=extractXML("rssi",doc);report+=`\nRSSI : ${rssi}`;setParam("rssi",rssi);if(mode==="WCDMA"){const rscp=extractXML("rscp",doc);const ecio=extractXML("ecio",doc);report+=`\nRSCP : ${rscp} EC/IO : ${ecio}`;setParam("rscp",rscp);barGraph("rscp",rscp,3,-100,-70);setParam("ecio",ecio);barGraph("ecio",ecio,2,-10,-2);}else if(mode==="LTE"){const rsrq=extractXML("rsrq",doc);const rsrp=extractXML("rsrp",doc);const sinr=extractXML("sinr",doc);report+=`\nRSRQ/RSRP/SINR : ${rsrq}/${rsrp}/${sinr}`;setParam("rsrp",rsrp);barGraph("rsrp",rsrp,3,-130,-60);setParam("rsrq",rsrq);barGraph("rsrq",rsrq,2,-16,-3);setParam("sinr",sinr);barGraph("sinr",sinr,2,0,24);}console.log(report);}}});$.ajax({type:"GET",async:true,url:'/api/monitoring/traffic-statistics',error:function(request,status,error){console.log("Error: Traffic statistics responce fail:",request.status,"\nmessage:",request.responseText,"\nerror:",error);},success:function(data){const doc=getXMLDocument(data);if(doc){const dl=extractXML("CurrentDownloadRate",doc);const ul=extractXML("CurrentUploadRate",doc);const report=`Download : ${dl} Upload : ${ul}`;setParam("dl",formatBandwidth(dl));setParam("ul",formatBandwidth(ul));console.log(report);}}});}function setBandWait(){if(timerInterval){clearInterval(timerInterval);timerInterval=null;}setVisible("t",true);setParam("t","PLEASE WAIT");setColor("t","orange");}function setBandSuccess(){setParam("t","SUCCESS");setColor("t","green");timerInterval=setInterval(function(){setVisible("t",false);},5000);}function setBandError(){setParam("t","ERROR");setColor("t","red");timerInterval=setInterval(function(){setVisible("t",false);},5000);}function ltebandselection(e){let band=prompt("Please input desirable LTE band number. If you want to use multiple LTE bands, write down multiple band number joined with '+'. If you want to use every supported bands, write down 'ALL'. (e.g. 3+7 / 1+3 / 1+3+8). Leave this empty to leave as is.","ALL");if(band==null || band===""){console.log("No band selected");return;}let lteFlags;if(band.toUpperCase()==="ALL"){lteFlags="7FFFFFFFFFFFFFFF";}else{let bandList=band.split('+');let flags=0;for(const bandId of bandList){flags=flags+Math.pow(2,parseInt(bandId)-1);}lteFlags=flags.toString(16);}console.log("LTE Band Flags:",lteFlags);setBandWait();$.ajax({type:"GET",async:true,url:'/html/home.html',error:function(request,status,error){console.log("Token Error:",request.status,"\nmessage:",request.responseText,"\nerror:",error);},success:function(data){let token=getDocumentCsrfToken(data);if(!token){console.log("Error: Web UI page is not logged in");return;}let nw=document.getElementById("force4g").checked?"03":"00";setTimeout(function(){$.ajax({type:"POST",async:true,url:'/api/net/net-mode',headers:{'__RequestVerificationToken':token},contentType:'application/xml',data:`<request><NetworkMode>${nw}</NetworkMode><NetworkBand>3FFFFFFF</NetworkBand><LTEBand>${lteFlags}</LTEBand></request>`,success:function(nd){let doc;if(typeof(nd)==="string" || nd instanceof String){doc=getXMLDocument(nd);}else{doc=nd;}let status=getResponseStatus(doc);if(status===0){console.log("Network mode set successfully");setBandSuccess();}else{console.log("Error while setting band list");setBandError();}supportedBands();},error:function(request,status,error){console.log("Net Mode Error:",request.status,"\nmessage:",request.responseText,"\nerror:",error);setBandError();supportedBands();}});},2000);}});}function getBandFlags(doc,tag){let flags=0n;for(const lt of doc.querySelectorAll(tag)){for(const t of lt.childNodes){if(t.nodeName==="Name" && t.innerHTML.toLowerCase()==="all bands")break;if(t.nodeName==="Value"){try{let f=BigInt(`0x${t.innerHTML}`);flags|=f;}catch(e){console.log("Error: Cannot parse band mask:",err.message);}}}}return flags;}function supportedBands(){$.ajax({type:"GET",async:true,url:'/api/net/net-mode',error:function(request,status,error){console.log("Error: Active networks responce fail:",request.status,"\nmessage:",request.responseText,"\nerror:",error);},success:function(data){const doc=getXMLDocument(data);if(!doc){return;}let flagsActive=0n;try{do{const m=doc.querySelector("NetworkMode");if(!m)break;const mode=m.innerHTML;if(mode.indexOf("00")===-1 && mode.indexOf("03")===-1)break;const t=doc.querySelector("LTEBand");if(!t)break;flagsActive=BigInt(`0x${t.innerHTML}`);}while(0);}catch(err){console.log("Error: cannot parse band flags:",err.message);}console.log(`Active LTE flags: 0x${flagsActive.toString(16)}`);$.ajax({type:"GET",async:true,url:'/api/net/net-mode-list',error:function(request,status,error){console.log("Error: Supported networks responce fail:",request.status,"\nmessage:",request.responseText,"\nerror:",error);},success:function(data){const doc=getXMLDocument(data);if(!doc){return;}let flagsLte=getBandFlags(doc,"LTEBand");let supportedLte=[];let x=1;while(flagsLte!=0n){if((flagsLte & 1n)!==0n){supportedLte.push(x);}x++;flagsLte=flagsLte>>1n;}setParam('support_lte',supportedLte.map(function(k){return `<span class="${(flagsActive&(1n<<BigInt(k-1)))!==0n?"band_on":"band_off"}">B${k}</span>`;}).join('+'));let report=`Supported LTE: ${supportedLte.map(function(k){return `B${k}`}).join('+')}`;console.log(report);}});}});}function statusHeader(){document.body.insertAdjacentHTML("afterbegin",'<style>#mode,#rssi,#rscp,#ecio,#rsrq,#rsrp,#sinr,#ul,#dl,#support_lte{color:#b00;font-weight:strong;}.band_on{color:blue;}.band_off{color:grey;}#setband{font-weight:bolder;background-color:#448;color:white;padding:10px;border-radius:10px;}.f{float:left;border:1px solid #bbb;border-radius:5px;padding:10px;line-height:2em;margin:5px;}.f ul{margin:0;padding:0;}.f ul li{display:inline;margin-right:10px;}#t{float:left;color:white;margin:10px;padding:10px;border-radius:10px;display:none;text-align:center;font-weight:bolder;}</style><div style="display:block;overflow:auto;"><div class="f" id="status_general"><ul><li>Network mode:<span id="mode">#</span></li><li>RSSI:<span id="rssi">#</span></li></ul></div><div class="f" id="status_3g">RSCP:<span id="rscp">#</span><div id="brscp"></div>EC/IO:<span id="ecio">#</span><div id="becio"></div></div><div class="f" id="status_lte">RSRQ:<span id="rsrq">#</span><div id="brsrq"></div>RSRP:<span id="rsrp">#</span><div id="brsrp"></div>SINR:<span id="sinr">#</span><div id="bsinr"></div></div><div class="f" id="bandwidth"><ul><li>Download:<span id="dl">#</span></li><li>Upload:<span id="ul">#</span></li></ul></div></div><div style="display:block;overflow:auto;"><div class="f"><ul><li><a id="setband" href="#">Set LTE Bands</a></li><li><label>LTE Only</label>&nbsp;<input id="force4g" type="checkbox"></li></ul></div><div id="t"></div><div class="f"><ul><li>SUPPORTED LTE:<span id="support_lte"></span></li></ul></div></div>');document.getElementById("setband").addEventListener("click",ltebandselection,false);supportedBands();setInterval(currentBand,2000);}statusHeader();