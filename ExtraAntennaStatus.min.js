javascript:const UPDATE_MS=2e3;let boxcar=80,gt=3,gw=boxcar*(gt+1),gh=30,ghd=1.75*gh;const SIZE_KB=1024,SIZE_MB=1048576,SIZE_GB=1073741824;let mode="",btstatus,history={sinr:[],rsrp:[],rsrq:[],rscp:[],ecio:[],dlul:[]},timerInterval;function getDocument(data,type){try{var doc=(new DOMParser).parseFromString(data,type);return doc.querySelector("parsererror")?null:doc}catch(e){}return null}function getXMLDocument(data){return getDocument(data,"application/xml")}function extractXML(tagName,doc){try{var tags=doc.querySelector(tagName);if(tags)return tags.innerHTML}catch(e){}return null}function getDocumentCsrfToken(data){var data=getXMLDocument(data);return(data=data&&data.querySelector("TokInfo"))?data.innerHTML:null}function getResponseStatus(doc){doc=doc.querySelector("response");return doc&&"OK"===doc.innerHTML?0:1}function formatBandwidth(bytesPerSec){bytesPerSec*=8;return bytesPerSec<SIZE_KB?bytesPerSec+"bit/s":bytesPerSec<SIZE_MB?(bytesPerSec/SIZE_KB).toFixed(2)+"KBit/s":(bytesPerSec/SIZE_MB).toFixed(2)+"MBit/s"}function clearUnit(s){return s.replace(/dB(m)?$/,"")}function getModeDescription(mode){switch(mode){case"0":return"GSM";case"2":return"WCDMA";case"7":return"LTE"}return"Unknown mode"}function setParam(param,val){try{document.getElementById(param).innerHTML=val}catch(e){}}function setVisible(id,visible){document.getElementById(id).style.display=visible?"block":"none"}function setColor(id,c){document.getElementById(id).style.backgroundColor=c}function setMode(newMode){if(mode!==newMode){for(var k in mode=newMode,setVisible("status_3g",!1),setVisible("status_lte",!1),setVisible("ucellid",!1),setVisible("u3g",!1),setVisible("ulte",!1),history)history[k]=[];"WCDMA"===mode?(setVisible("status_3g",!0),setVisible("ucellid",!0),setVisible("u3g",!0)):"LTE"===mode&&(setVisible("status_lte",!0),setVisible("ucellid",!0),setVisible("ulte",!0))}}function barGraph(p,val,min,max){(val=max<val?max:val)<min&&(val=min),history[p].unshift(val),history[p].length>boxcar&&history[p].pop();let html=`<svg version="1.1" viewBox="0 0 ${gw} ${gh}" width="${gw}" height="${gh}" preserveAspectRatio="xMaxYMax slice" style="border:1px solid #ccc;padding:1px;margin-top:-6px;width:${gw}px;">`;for(let x=0;x<history[p].length;x++){var pax=(gt+1)*(x+1),pay=gh-1;let pby=gh-(history[p][x]-min)/(max-min)*gh;isNaN(pby)&&(pby=pay);var pc=(history[p][x]-min)/(max-min)*100;html+=`<line x1="${pax}" y1="${pay}" x2="${pax}" y2="${pby}" stroke="${pc<50?"red":pc<85?"orange":"green"}" stroke-width="${gt}"></line>`}html+="</svg>",document.getElementById("b"+p).innerHTML=html}function nearestFib(x){let f1=0,f2=1,fn=0;for(let n=1;n<20&&!(x<(fn=f1+f2));n++)f2=f1,f1=fn;return fn}function barGraphDlUl(p,valDl,valUl){history[p].unshift([8*valDl,8*valUl]),history[p].length>boxcar&&history[p].pop();var valDl=history[p].reduce((accum,current)=>[Math.max(accum[0],current[0]),Math.max(accum[1],current[1])]),valUl=nearestFib(Math.max(valDl[0],valDl[1])/SIZE_MB),maxPlot=valUl*SIZE_MB;let html=`<svg version="1.1" viewBox="0 0 ${gw} ${ghd}" width="${gw}" height="${ghd}" preserveAspectRatio="xMaxYMax slice" style="border:1px solid #ccc;padding:1px;margin-top:-6px;width:${gw}px;">`;for(let x=0;x<history[p].length;x++){var dl=history[p][x][0],ul=history[p][x][1],pax=(gt+1)*(x+1),pay=ghd-1,pbyDl=ghd*(1-dl/maxPlot),pbyUl=ghd*(1-ul/maxPlot);let pby1=pay,pby2=pay,color2="grey";color2=ul<dl?(pby1=pbyUl,pby2=pbyDl,"#332288"):(pby1=pbyDl,pby2=pbyUl,"#88CCEE"),html=(html+=`<line x1="${pax}" y1="${pay}" x2="${pax}" y2="${pby1}" stroke="#DDCC77" stroke-width="${gt}"></line>`)+`<line x1="${pax}" y1="${pby1}" x2="${pax}" y2="${pby2}" stroke="${color2}" stroke-width="${gt}"></line>`}html=html+`<text x="${gw}" y="5" dominant-baseline="hanging" text-anchor="end" style="fill:gray;">${valUl.toFixed(0)}MBit/s</text>`+"</svg>",document.getElementById("b"+p).innerHTML=html}function currentBand(){$.ajax({type:"GET",async:!0,url:"/api/device/signal",success:function(data){data=getXMLDocument(data);if(data){var currentMode=getModeDescription(extractXML("mode",data)),currentMode=(setParam("mode",currentMode),setMode(currentMode),extractXML("rssi",data)),currentMode=(setParam("rssi",currentMode),Number(extractXML("cell_id",data)));if(setParam("cellidhex",currentMode.toString(16).toUpperCase()),setParam("cellid",currentMode),"WCDMA"===mode){var rscp=extractXML("rscp",data),ecio=extractXML("ecio",data),rscp=(setParam("rscp",rscp),barGraph("rscp",clearUnit(rscp),-100,-70),setParam("ecio",ecio),barGraph("ecio",clearUnit(ecio),-10,-2),extractXML("sc",data)),ecio=(setParam("psc",rscp),currentMode>>16),rscp=65535&currentMode,ecio=(setParam("rnc",ecio),Math.floor(rscp/10)),rscp=rscp-10*ecio;setParam("nb",ecio),setParam("cc",rscp)}else if("LTE"===mode){var ecio=extractXML("rsrq",data),rscp=extractXML("rsrp",data),sinr=extractXML("sinr",data),rscp=(setParam("rsrp",rscp),barGraph("rsrp",clearUnit(rscp),-130,-60),setParam("rsrq",ecio),barGraph("rsrq",clearUnit(ecio),-16,-3),setParam("sinr",sinr),barGraph("sinr",clearUnit(sinr),0,24),extractXML("pci",data)),ecio=(setParam("pci",rscp),currentMode>>8);const id=255&currentMode;setParam("enb",ecio),setParam("cell",id)}}}}),$.ajax({type:"GET",async:!0,url:"/api/monitoring/traffic-statistics",success:function(data){var dl,dlStr,ulStr,data=getXMLDocument(data);data&&(dl=extractXML("CurrentDownloadRate",data),data=extractXML("CurrentUploadRate",data),dlStr=formatBandwidth(dl),ulStr=formatBandwidth(data),setParam("dl",dlStr),setParam("ul",ulStr),barGraphDlUl("dlul",dl,data))}}),$.ajax({type:"GET",async:!0,url:"/api/net/current-plmn",success:function(data){data=getXMLDocument(data);data&&setParam("plmn",extractXML("Numeric",data))}}),$.ajax({type:"GET",async:!0,url:"/api/monitoring/status",success:function(data){var newstatus,data=getXMLDocument(data);data&&(newstatus=extractXML("BatteryStatus",data),btstatus!==newstatus&&setVisible("battery",""!==(btstatus=newstatus)),""!==btstatus)&&(setParam("btlevel",extractXML("BatteryPercent",data)+"%"),setParam("btsource",{0:"No Charge",1:"Charging","-1":"Low",2:"No Battery"}[btstatus.toString()]))}})}function setBandWait(){timerInterval&&(clearInterval(timerInterval),timerInterval=null),setVisible("t",!0),setParam("t","PLEASE WAIT"),setColor("t","orange")}function setBandSuccess(){setParam("t","SUCCESS"),setColor("t","green"),timerInterval=setInterval(function(){setVisible("t",!1)},5e3)}function setBandError(){setParam("t","ERROR"),setColor("t","red"),timerInterval=setInterval(function(){setVisible("t",!1)},5e3)}function ltebandselection(e){var band=prompt("Please input desirable LTE band number. If you want to use multiple LTE bands, write down multiple band number joined with '+'. If you want to use every supported bands, write down 'ALL'. (e.g. 3+7 / 1+3 / 1+3+8). Leave this empty to leave as is.","ALL");if(null!==band&&""!==band){let lteFlags;if("ALL"===band.toUpperCase())lteFlags="7FFFFFFFFFFFFFFF";else{let flags=0;for(const bandId of band.split("+"))flags+=Math.pow(2,parseInt(bandId)-1);lteFlags=flags.toString(16)}setBandWait(),$.ajax({type:"GET",async:!0,url:"/api/webserver/SesTokInfo",success:function(data){let token=getDocumentCsrfToken(data);if(token){let nw=function(){switch(document.getElementById("mode_lte").value){case"0":return"00";case"1":return"0103";case"2":return"0203";case"3":return"03"}return"00"}();setTimeout(function(){$.ajax({type:"POST",async:!0,url:"/api/net/net-mode",headers:{__RequestVerificationToken:token},contentType:"application/xml",data:`<request><NetworkMode>${nw}</NetworkMode><NetworkBand>3FFFFFFF</NetworkBand><LTEBand>${lteFlags}</LTEBand></request>`,success:function(nd){let doc;(0===getResponseStatus(doc="string"==typeof nd||nd instanceof String?getXMLDocument(nd):nd)?setBandSuccess:setBandError)(),supportedBands()},error:function(_1,_2,_3){setBandError(),supportedBands()}})},UPDATE_MS)}}})}}function binZero(){return"0".repeat(63).split("")}function hexToBin(s){return s.padStart(16,"0").split("").map(c=>parseInt(c,16).toString(2).padStart(4,"0")).join("").substring(1).split("").reverse()}function getBandFlags(doc,tag){let flags=binZero();for(const lt of doc.querySelectorAll(tag))for(const t of lt.childNodes){if("Name"===t.nodeName&&"all bands"===t.innerHTML.toLowerCase())break;if("Value"===t.nodeName)try{flags=hexToBin(t.innerHTML).map((c,i)=>"1"===c||"1"===flags[i]?"1":"0")}catch(e){}}return flags}function supportedBands(){$.ajax({type:"GET",async:!0,url:"/api/net/net-mode",success:function(data){var doc=getXMLDocument(data);if(doc){let flagsActive=binZero();try{do{var m=doc.querySelector("NetworkMode");if(!m)break;var mode=m.innerHTML;if(-1===mode.indexOf("00")&&-1===mode.indexOf("03"))break;var t=doc.querySelector("LTEBand");t&&(flagsActive=hexToBin(t.innerHTML))}while(0)}catch(e){}$.ajax({type:"GET",async:!0,url:"/api/net/net-mode-list",success:function(data){data=getXMLDocument(data);data&&setParam("support_lte",getBandFlags(data,"LTEBand").map((k,i)=>"1"===k?i+1:0).filter(k=>0<k).map(k=>`<span class="${"1"===flagsActive[k-1]?"band_on":"band_off"}">B${k}</span>`).join("+"))}})}}})}function statusHeader(){document.body.insertAdjacentHTML("afterbegin",'<style>#mode,#rssi,#plmn,#cellidhex,#cellid,#nb,#cc,#rnc,#psc,#enb,#cell,#pci,#rscp,#ecio,#rsrq,#rsrp,#sinr,#ul,#dl,#support_lte,#btlevel,#btsource{color:#b00;font-weight:strong;}.band_on{color:blue;}.band_off{color:grey;}#setband{font-weight:bolder;background-color:#448;color:white;padding:10px;border-radius:10px;}.f{float:left;border:1px solid #bbb;border-radius:5px;padding:10px;line-height:2em;margin:5px;}.f ul{margin:0;padding:0;}.f ul li{display:inline;margin-right:10px;}.f ul li label{display:inline;}#t{float:left;color:white;margin:10px;padding:10px;border-radius:10px;display:none;text-align:center;font-weight:bolder;}</style><div style="display:block;overflow:auto;"><div class="f" id="status_general"><ul><li>Network mode:<span id="mode">#</span></li><li>RSSI:<span id="rssi">#</span></li></ul><ul><li>PLMN:<span id="plmn">#</span></li></ul><ul id="ucellid"><li>Cell ID:<span id="cellidhex">#</span>/<span id="cellid">#</span></li></ul><ul id="u3g"><li>NB ID / Cell:<span id="nb">#</span>/<span id="cc">#</span></li><li>RNC-ID:<span id="rnc">#</span></li><li>SC:<span id="psc">#</span></li></ul><ul id="ulte"><li>eNB / Cell:<span id="enb">#</span>/<span id="cell">#</span></li><li>PCI:<span id="pci">#</span></li></ul></div><div class="f" id="status_3g">RSCP:<span id="rscp">#</span><div id="brscp"></div>EC/IO:<span id="ecio">#</span><div id="becio"></div></div><div class="f" id="status_lte">RSRQ:<span id="rsrq">#</span><div id="brsrq"></div>RSRP:<span id="rsrp">#</span><div id="brsrp"></div>SINR:<span id="sinr">#</span><div id="bsinr"></div></div><div class="f" id="bandwidth"><ul><li>Download:<span id="dl">#</span></li><li>Upload:<span id="ul">#</span></li></ul><div id="bdlul"></div></div><div class="f" id="battery"><ul><li>Battery:<span id="btlevel">#</span></li><li>Charge:<span id="btsource">#</span></li></ul></div></div><div style="display:block;overflow:auto;"><div class="f"><ul><li><a id="setband" href="#">Set LTE Bands</a></li><li><label>Mode</label>&nbsp;<select id="mode_lte"><option value="0">Auto</option><option value="1">LTE > GSM</option><option value="2">LTE > WCDMA</option><option value="3" selected="on">LTE Only</option></select></li></ul></div><div id="t"></div><div class="f"><ul><li>SUPPORTED LTE:<span id="support_lte"></span></li></ul></div></div>'),document.getElementById("setband").addEventListener("click",ltebandselection,!1),supportedBands(),setInterval(currentBand,UPDATE_MS)}statusHeader();