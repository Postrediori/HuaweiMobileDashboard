javascript:const UPDATE_MS=2e3;let mode="",history={sinr:[],rsrp:[],rsrq:[],rscp:[],ecio:[]},boxcar=100,gt=3,gw=boxcar*(gt+1),gh=30,timerInterval;function getDocument(data,type){try{var doc=(new DOMParser).parseFromString(data,type);return doc.querySelector("parsererror")?(console.log("DOM Error: Error while parsing"),null):doc}catch(err){console.log("DOM Error:",err.message)}return null}function getXMLDocument(data){return getDocument(data,"application/xml")}function getHTMLDocument(data){return getDocument(data,"text/html")}function extractXML(tagName,doc){try{var tags=doc.querySelector(tagName);if(tags)return tags.innerHTML}catch(err){console.log("XML Error:",err.message)}return null}function getDocumentCsrfToken(data){data=getHTMLDocument(data);if(data){for(const tag of data.querySelectorAll("meta"))if("csrf_token"===tag.getAttribute("name")){var token=tag.getAttribute("content");if(token)return token}}else console.log("Error:Cannot get Web UI page");return null}function getResponseStatus(doc){var tag=doc.querySelector("response");if(tag&&"OK"===tag.innerHTML)return 0;tag=doc.querySelector("error");if(tag){let report="Received response";for(const t of tag.children)""!==t.innerHTML&&(report+=` ${t.nodeName}:`+t.innerHTML);console.log("Error:",report)}else console.log("Error: Received response with unknown status");return 1}function formatBandwidth(bytesPerSec){bytesPerSec*=8;return bytesPerSec<1024?bytesPerSec+"bit/s":bytesPerSec<1048576?(bytesPerSec/1024).toFixed(2)+"KBit/s":(bytesPerSec/1048576).toFixed(2)+"MBit/s"}function clearUnit(s){return s.replace(/dB(m)?$/,"")}function getModeDescription(mode){switch(mode){case"0":return"GSM";case"2":return"WCDMA";case"7":return"LTE"}return"Unknown mode"}function setParam(param,val){try{document.getElementById(param).innerHTML=val}catch(param){}}function setVisible(id,visible){document.getElementById(id).style.display=visible?"block":"none"}function setColor(id,c){document.getElementById(id).style.backgroundColor=c}function setMode(newMode){if(mode!==newMode){for(var k in mode=newMode,console.log("Network mode set to",mode),setVisible("status_3g",!1),setVisible("status_lte",!1),history)history[k]=[];"WCDMA"===mode?setVisible("status_3g",!0):"LTE"===mode&&setVisible("status_lte",!0)}}function barGraph(p,val,min,max){(val=max<val?max:val)<min&&(val=min),history[p].unshift(val),history[p].length>boxcar&&history[p].pop();let html=`<svg version="1.1" viewBox="0 0 ${gw} ${gh}" width="${gw}" height="${gh}" preserveAspectRatio="xMaxYMax slice" style="border:1px solid #ccc;padding:1px;margin-top:-6px;width:${gw}px;">`;for(let x=0;x<history[p].length;x++){var pax=(gt+1)*(x+1),pay=gh-1;let pby=gh-(history[p][x]-min)/(max-min)*gh;isNaN(pby)&&(pby=pay);var pc=(history[p][x]-min)/(max-min)*100;html+=`<line x1="${pax}" y1="${pay}" x2="${pax}" y2="${pby}" stroke="${pc<50?"red":pc<85?"orange":"green"}" stroke-width="${gt}"></line>`}html+="</svg>",document.getElementById("b"+p).innerHTML=html}function currentBand(){$.ajax({type:"GET",async:!0,url:"/api/device/signal",error:function(request,status,error){console.log("Error: Cannot get Signal data:",request.status,"\nmessage:",request.responseText,"\nerror:",error)},success:function(data){data=getXMLDocument(data);if(data){var currentMode=getModeDescription(extractXML("mode",data));let report="Network mode : "+currentMode;setParam("mode",currentMode),setMode(currentMode);var ecio,currentMode=extractXML("rssi",data);report+=`\nRSSI : `+currentMode,setParam("rssi",currentMode),"WCDMA"===mode?(currentMode=extractXML("rscp",data),ecio=extractXML("ecio",data),report+=`\nRSCP : ${currentMode} EC/IO : `+ecio,setParam("rscp",currentMode),barGraph("rscp",clearUnit(currentMode),-100,-70),setParam("ecio",ecio),barGraph("ecio",clearUnit(ecio),-10,-2)):"LTE"===mode&&(currentMode=extractXML("rsrq",data),ecio=extractXML("rsrp",data),data=extractXML("sinr",data),report+=`\nRSRQ/RSRP/SINR : ${currentMode}/${ecio}/`+data,setParam("rsrp",ecio),barGraph("rsrp",clearUnit(ecio),-130,-60),setParam("rsrq",currentMode),barGraph("rsrq",clearUnit(currentMode),-16,-3),setParam("sinr",data),barGraph("sinr",clearUnit(data),0,24)),console.log(report)}}}),$.ajax({type:"GET",async:!0,url:"/api/monitoring/traffic-statistics",error:function(request,status,error){console.log("Error: Traffic statistics response fail:",request.status,"\nmessage:",request.responseText,"\nerror:",error)},success:function(data){var dl,report,data=getXMLDocument(data);data&&(report=`Download : ${dl=extractXML("CurrentDownloadRate",data)} Upload : `+(data=extractXML("CurrentUploadRate",data)),setParam("dl",formatBandwidth(dl)),setParam("ul",formatBandwidth(data)),console.log(report))}})}function setBandWait(){timerInterval&&(clearInterval(timerInterval),timerInterval=null),setVisible("t",!0),setParam("t","PLEASE WAIT"),setColor("t","orange")}function setBandSuccess(){setParam("t","SUCCESS"),setColor("t","green"),timerInterval=setInterval(function(){setVisible("t",!1)},5e3)}function setBandError(){setParam("t","ERROR"),setColor("t","red"),timerInterval=setInterval(function(){setVisible("t",!1)},5e3)}function ltebandselection(e){var band=prompt("Please input desirable LTE band number. If you want to use multiple LTE bands, write down multiple band number joined with '+'. If you want to use every supported bands, write down 'ALL'. (e.g. 3+7 / 1+3 / 1+3+8). Leave this empty to leave as is.","ALL");if(null==band||""===band)console.log("No band selected");else{let lteFlags;if("ALL"===band.toUpperCase())lteFlags="7FFFFFFFFFFFFFFF";else{let flags=0;for(const bandId of band.split("+"))flags+=Math.pow(2,parseInt(bandId)-1);lteFlags=flags.toString(16)}console.log("LTE Band Flags:",lteFlags),setBandWait(),$.ajax({type:"GET",async:!0,url:"/html/home.html",error:function(request,status,error){console.log("Token Error:",request.status,"\nmessage:",request.responseText,"\nerror:",error)},success:function(data){let token=getDocumentCsrfToken(data);if(token){let nw=document.getElementById("force4g").checked?"03":"00";setTimeout(function(){$.ajax({type:"POST",async:!0,url:"/api/net/net-mode",headers:{__RequestVerificationToken:token},contentType:"application/xml",data:`<request><NetworkMode>${nw}</NetworkMode><NetworkBand>3FFFFFFF</NetworkBand><LTEBand>${lteFlags}</LTEBand></request>`,success:function(nd){let doc;(0===getResponseStatus(doc="string"==typeof nd||nd instanceof String?getXMLDocument(nd):nd)?(console.log("Network mode set successfully"),setBandSuccess):(console.log("Error while setting band list"),setBandError))(),supportedBands()},error:function(request,status,error){console.log("Net Mode Error:",request.status,"\nmessage:",request.responseText,"\nerror:",error),setBandError(),supportedBands()}})},UPDATE_MS)}else console.log("Error: Web UI page is not logged in")}})}}function getBandFlags(doc,tag){let flags=0n;for(const lt of doc.querySelectorAll(tag))for(const t of lt.childNodes){if("Name"===t.nodeName&&"all bands"===t.innerHTML.toLowerCase())break;if("Value"===t.nodeName)try{var f=BigInt("0x"+t.innerHTML);flags|=f}catch(err){console.log("Error: Cannot parse band mask:",err.message)}}return flags}function supportedBands(){$.ajax({type:"GET",async:!0,url:"/api/net/net-mode",error:function(request,status,error){console.log("Error: Active networks response fail:",request.status,"\nmessage:",request.responseText,"\nerror:",error)},success:function(data){var doc=getXMLDocument(data);if(doc){let flagsActive=0n;try{do{var m=doc.querySelector("NetworkMode");if(!m)break;var mode=m.innerHTML;if(-1===mode.indexOf("00")&&-1===mode.indexOf("03"))break;var t=doc.querySelector("LTEBand");t&&(flagsActive=BigInt("0x"+t.innerHTML))}while(0)}catch(err){console.log("Error: cannot parse band flags:",err.message)}console.log("Active LTE flags: 0x"+flagsActive.toString(16)),$.ajax({type:"GET",async:!0,url:"/api/net/net-mode-list",error:function(request,status,error){console.log("Error: Supported networks response fail:",request.status,"\nmessage:",request.responseText,"\nerror:",error)},success:function(data){data=getXMLDocument(data);if(data){let flagsLte=getBandFlags(data,"LTEBand");var supportedLte=[];let x=1;for(;0n!=flagsLte;)0n!==(1n&flagsLte)&&supportedLte.push(x),x++,flagsLte>>=1n;setParam("support_lte",supportedLte.map(function(k){return`<span class="${0n!==(flagsActive&1n<<BigInt(k-1))?"band_on":"band_off"}">B${k}</span>`}).join("+"));data="Supported LTE: "+supportedLte.map(function(k){return"B"+k}).join("+");console.log(data)}}})}}})}function statusHeader(){document.body.insertAdjacentHTML("afterbegin",'<style>#mode,#rssi,#rscp,#ecio,#rsrq,#rsrp,#sinr,#ul,#dl,#support_lte{color:#b00;font-weight:strong;}.band_on{color:blue;}.band_off{color:grey;}#setband{font-weight:bolder;background-color:#448;color:white;padding:10px;border-radius:10px;}.f{float:left;border:1px solid #bbb;border-radius:5px;padding:10px;line-height:2em;margin:5px;}.f ul{margin:0;padding:0;}.f ul li{display:inline;margin-right:10px;}#t{float:left;color:white;margin:10px;padding:10px;border-radius:10px;display:none;text-align:center;font-weight:bolder;}</style><div style="display:block;overflow:auto;"><div class="f" id="status_general"><ul><li>Network mode:<span id="mode">#</span></li><li>RSSI:<span id="rssi">#</span></li></ul></div><div class="f" id="status_3g">RSCP:<span id="rscp">#</span><div id="brscp"></div>EC/IO:<span id="ecio">#</span><div id="becio"></div></div><div class="f" id="status_lte">RSRQ:<span id="rsrq">#</span><div id="brsrq"></div>RSRP:<span id="rsrp">#</span><div id="brsrp"></div>SINR:<span id="sinr">#</span><div id="bsinr"></div></div><div class="f" id="bandwidth"><ul><li>Download:<span id="dl">#</span></li><li>Upload:<span id="ul">#</span></li></ul></div></div><div style="display:block;overflow:auto;"><div class="f"><ul><li><a id="setband" href="#">Set LTE Bands</a></li><li><label>LTE Only</label>&nbsp;<input id="force4g" type="checkbox"></li></ul></div><div id="t"></div><div class="f"><ul><li>SUPPORTED LTE:<span id="support_lte"></span></li></ul></div></div>'),document.getElementById("setband").addEventListener("click",ltebandselection,!1),supportedBands(),setInterval(currentBand,UPDATE_MS)}statusHeader();