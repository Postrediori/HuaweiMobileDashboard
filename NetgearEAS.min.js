javascript:let mode="",history={sinr:[],rsrp:[],rsrq:[],rscp:[],ecio:[],dl:0,ul:0,dlultime:0},boxcar=100,gt=3,gw=boxcar*(gt+1),gh=30;function formatBandwidth(bytesPerSec){bytesPerSec*=8;return bytesPerSec<1024?bytesPerSec+"bit/s":bytesPerSec<1048576?(bytesPerSec/1024).toFixed(2)+"KBit/s":(bytesPerSec/1048576).toFixed(2)+"MBit/s"}function getModeDescription(mode){switch(mode){case"WcdmaService":return"WCDMA";case"LteService":return"LTE"}return"Unknown mode"}function setParam(param,val){try{document.getElementById(param).innerHTML=val}catch(param){}}function setVisible(id,visible){document.getElementById(id).style.display=visible?"block":"none"}function setMode(newMode){if(mode!==newMode){for(var k in mode=newMode,console.log("Network mode set to",mode),setVisible("status_3g",!1),setVisible("status_lte",!1),history)history[k]=Array.isArray(history[k])?[]:0;"WCDMA"===mode?setVisible("status_3g",!0):"LTE"===mode&&setVisible("status_lte",!0)}}function barGraph(p,val,min,max){(val=max<val?max:val)<min&&(val=min),history[p].unshift(val),history[p].length>boxcar&&history[p].pop();let html=`<svg version="1.1" viewBox="0 0 ${gw} ${gh}" width="${gw}" height="${gh}" preserveAspectRatio="xMaxYMax slice" style="border:1px solid #ccc;padding:1px;margin-top:-6px;width:${gw}px;">`;for(let x=0;x<history[p].length;x++){var pax=(gt+1)*(x+1),pay=gh-1;let pby=gh-(history[p][x]-min)/(max-min)*gh;isNaN(pby)&&(pby=pay);var pc=(history[p][x]-min)/(max-min)*100;html+=`<line x1="${pax}" y1="${pay}" x2="${pax}" y2="${pby}" stroke="${pc<50?"red":pc<85?"orange":"green"}" stroke-width="${gt}"></line>`}html+="</svg>",document.getElementById("b"+p).innerHTML=html}function currentBand(){$.ajax({type:"GET",async:!0,url:"/api/model.json?internalapi=1",error:function(request,status,error){console.log("Error: Cannot get Signal data:",request.status,"\nmessage:",request.responseText,"\nerror:",error)},success:function(data){data=JSON.parse(data);if(data){var currentMode=getModeDescription(data.wwan.currentNWserviceType),fullMode=currentMode+(0===data.wwan.ca.SCCcount?"":"-A");let report="Network mode : "+fullMode;setParam("mode",fullMode),setMode(currentMode);var dlRate,fullMode=data.wwan.signalStrength.rssi,fullMode=(report+=`\nRSSI : ${fullMode}dBm`,setParam("rssi",fullMode+"dBm"),"WCDMA"===mode?(currentMode=data.wwan.signalStrength.rscp,fullMode=data.wwan.signalStrength.ecio,report+=`\nRSCP : ${currentMode}dBm EC/IO : ${fullMode}dB`,setParam("rscp",currentMode+"dBm"),barGraph("rscp",currentMode,-100,-70),setParam("ecio",fullMode+"dB"),barGraph("ecio",fullMode,-10,-2)):"LTE"===mode&&(currentMode=data.wwan.signalStrength.rsrq,fullMode=data.wwan.signalStrength.rsrp,sinr=data.wwan.signalStrength.sinr,report+=`\nRSRQ/RSRP/SINR : ${currentMode}dB/${fullMode}dBm/${sinr}dB`,setParam("rsrp",fullMode+"dBm"),barGraph("rsrp",fullMode,-130,-60),setParam("rsrq",currentMode+"dB"),barGraph("rsrq",currentMode,-16,-3),setParam("sinr",sinr+"dB"),barGraph("sinr",sinr,0,24)),data.wwan.dataTransferredRx),currentMode=data.wwan.dataTransferredTx,sinr=(new Date).getTime();0!==history.dlultime&&(data=sinr-history.dlultime,dlRate=0===history.dl?0:Math.floor(1e3*(fullMode-history.dl)/data),data=0===history.ul?0:Math.floor(1e3*(currentMode-history.ul)/data),report+=`\nDownload : ${dlRate.toFixed(0)} Upload : `+data.toFixed(0),setParam("dl",formatBandwidth(dlRate)),setParam("ul",formatBandwidth(data)),history.dl=fullMode,history.ul=currentMode),history.dlultime=sinr,console.log(report)}}})}function statusHeader(){document.body.insertAdjacentHTML("afterbegin",'<style>#mode,#rssi,#rscp,#ecio,#rsrq,#rsrp,#sinr,#ul,#dl{color:#b00;font-weight:strong;}.f{float:left;border:1px solid #bbb;border-radius:5px;padding:10px;line-height:2em;margin:5px;}.f ul{margin:0;padding:0;}.f ul li{display:inline;margin-right:10px;}</style><div style="display:block;overflow:auto;"><div class="f" id="status_general"><ul><li>Network mode:<span id="mode">#</span></li><li>RSSI:<span id="rssi">#</span></li></ul></div><div class="f" id="status_3g">RSCP:<span id="rscp">#</span><div id="brscp"></div>EC/IO:<span id="ecio">#</span><div id="becio"></div></div><div class="f" id="status_lte">RSRQ:<span id="rsrq">#</span><div id="brsrq"></div>RSRP:<span id="rsrp">#</span><div id="brsrp"></div>SINR:<span id="sinr">#</span><div id="bsinr"></div></div><div class="f" id="bandwidth"><ul><li>Download:<span id="dl">#</span></li><li>Upload:<span id="ul">#</span></li></ul></div></div>'),setInterval(currentBand,2e3)}statusHeader();