javascript:let UPDATE_MS=2e3,boxcar=78,gt=3,gw=boxcar*(gt+1),gh=30,ghd=1.75*gh,SIZE_KB=1024,SIZE_MB=1048576,SIZE_GB=1073741824,mode="",btstate,history={sinr:[],rsrp:[],rsrq:[],rscp:[],ecio:[],dl:0,ul:0,dlultime:0,dlul:[]};function formatBandwidth(bytesPerSec){bytesPerSec*=8;return bytesPerSec<SIZE_KB?bytesPerSec+"bit/s":bytesPerSec<SIZE_MB?(bytesPerSec/SIZE_KB).toFixed(2)+"KBit/s":(bytesPerSec/SIZE_MB).toFixed(2)+"MBit/s"}function getModeDescription(mode){switch(mode){case"GsmService":return"GSM";case"WcdmaService":return"WCDMA";case"LteService":return"LTE"}return"Unknown mode"}function setParam(param,val){try{document.getElementById(param).innerHTML=val}catch(param){}}function setVisible(id,visible,t="block"){document.getElementById(id).style.display=visible?t:"none"}function setMode(newMode){if(mode!==newMode){for(var k in mode=newMode,console.log("Network mode set to",mode),setVisible("status_3g",!1),setVisible("status_lte",!1),setVisible("u3g",!1),setVisible("ulte",!1),history)history[k]=Array.isArray(history[k])?[]:0;"WCDMA"===mode?(setVisible("status_3g",!0),setVisible("u3g",!0)):"LTE"===mode&&(setVisible("status_lte",!0),setVisible("ulte",!0))}}function barGraph(p,val,min,max){(val=max<val?max:val)<min&&(val=min),history[p].unshift(val),history[p].length>boxcar&&history[p].pop();let html=`<svg version="1.1" viewBox="0 0 ${gw} ${gh}" width="${gw}" height="${gh}" preserveAspectRatio="xMaxYMax slice" style="border:1px solid #ccc;padding:1px;margin-top:-6px;width:${gw}px;">`;for(let x=0;x<history[p].length;x++){var pax=(gt+1)*(x+1),pay=gh-1;let pby=gh-(history[p][x]-min)/(max-min)*gh;isNaN(pby)&&(pby=pay);var pc=(history[p][x]-min)/(max-min)*100;html+=`<line x1="${pax}" y1="${pay}" x2="${pax}" y2="${pby}" stroke="${pc<50?"red":pc<85?"orange":"green"}" stroke-width="${gt}"></line>`}html+="</svg>",document.getElementById("b"+p).innerHTML=html}function nearestFib(x){let f1=0,f2=1,fn=0;for(let n=1;n<20&&!(x<(fn=f1+f2));n++)f2=f1,f1=fn;return fn}function barGraphDlUl(p,valDl,valUl){history[p].unshift([8*valDl,8*valUl]),history[p].length>boxcar&&history[p].pop();var valDl=history[p].reduce((accum,current)=>[Math.max(accum[0],current[0]),Math.max(accum[1],current[1])]),valUl=nearestFib(Math.max(valDl[0],valDl[1])/SIZE_MB),maxPlot=valUl*SIZE_MB;let html=`<svg version="1.1" viewBox="0 0 ${gw} ${ghd}" width="${gw}" height="${ghd}" preserveAspectRatio="xMaxYMax slice" style="border:1px solid #ccc;padding:1px;margin-top:-6px;width:${gw}px;">`;for(let x=0;x<history[p].length;x++){var dl=history[p][x][0],ul=history[p][x][1],pax=(gt+1)*(x+1),pay=ghd-1,pbyDl=ghd*(1-dl/maxPlot),pbyUl=ghd*(1-ul/maxPlot);let pby1=pay,pby2=pay,color2="grey";color2=ul<dl?(pby1=pbyUl,pby2=pbyDl,"#332288"):(pby1=pbyDl,pby2=pbyUl,"#88CCEE"),html=(html+=`<line x1="${pax}" y1="${pay}" x2="${pax}" y2="${pby1}" stroke="#DDCC77" stroke-width="${gt}"></line>`)+`<line x1="${pax}" y1="${pby1}" x2="${pax}" y2="${pby2}" stroke="${color2}" stroke-width="${gt}"></line>`}html=html+`<text x="${gw}" y="6" dominant-baseline="hanging" text-anchor="end" style="fill:gray;">${valUl.toFixed(0)}MBit/s</text>`+"</svg>",document.getElementById("b"+p).innerHTML=html}function currentBand(){$.ajax({type:"GET",async:!0,url:"/api/model.json?internalapi=1",success:function(data){data=JSON.parse(data);if(data){var currentMode=getModeDescription(data.wwan.currentNWserviceType);let caStatus=data.wwan.ca.SCCcount;setParam("mode",""+currentMode+(0===(caStatus=void 0===caStatus?0:caStatus)?"":"-A")),setMode(currentMode);var dlRate,dlRateStr,ulRateStr,currentMode=data.wwanadv.curBand,currentMode=(setParam("band",currentMode),setVisible("castat",0!==caStatus,"inline"),setParam("ca",caStatus),data.wwan.signalStrength.rssi+"dBm"),currentMode=(setParam("rssi",currentMode),data.wwanadv.MCC+data.wwanadv.MNC),currentMode=(setParam("plmn",currentMode),data.wwanadv.cellId);if(setParam("cellidhex",currentMode.toString(16).toUpperCase()),setParam("cellid",currentMode),"WCDMA"===mode){var rscp=data.wwan.signalStrength.rscp,ecio=data.wwan.signalStrength.ecio,rscp=(setParam("rscp",rscp+"dBm"),barGraph("rscp",rscp,-100,-70),setParam("ecio",ecio+"dB"),barGraph("ecio",ecio,-10,-2),data.wwanadv.primScode),ecio=(setParam("psc",rscp),currentMode>>16),rscp=65535&currentMode,ecio=(setParam("rnc",ecio),Math.floor(rscp/10)),rscp=rscp-10*ecio;setParam("nb",ecio),setParam("cc",rscp)}else if("LTE"===mode){var ecio=data.wwan.signalStrength.rsrq,rscp=data.wwan.signalStrength.rsrp,sinr=data.wwan.signalStrength.sinr,rscp=(setParam("rsrp",rscp+"dBm"),barGraph("rsrp",rscp,-130,-60),setParam("rsrq",ecio+"dB"),barGraph("rsrq",ecio,-16,-3),setParam("sinr",sinr+"dB"),barGraph("sinr",sinr,0,24),data.wwanadv.primScode),ecio=(-1===rscp?setVisible("lpci",!1):(setVisible("lpci",!0,"inline"),setParam("pci",rscp)),currentMode>>8);let id=255&currentMode;setParam("enb",ecio),setParam("cell",id)}0<=data.wwan.dataTransferred&&(sinr=data.wwan.dataTransferredRx,rscp=data.wwan.dataTransferredTx,currentMode=(new Date).getTime(),0!==history.dlultime&&(ecio=1e3/(currentMode-history.dlultime),dlRate=0===history.dl?0:Math.floor((sinr-history.dl)*ecio),ecio=0===history.ul?0:Math.floor((rscp-history.ul)*ecio),dlRateStr=formatBandwidth(dlRate),ulRateStr=formatBandwidth(ecio),setParam("dl",dlRateStr),setParam("ul",ulRateStr),barGraphDlUl("dlul",dlRate,ecio),history.dl=sinr,history.ul=rscp),history.dlultime=currentMode),btstate!==data.power.batteryState&&setVisible("battery","NoBattery"!==(btstate=data.power.batteryState)),"NoBattery"!==btstate&&(setParam("btlevel",data.power.battChargeLevel+"%"),setParam("btsource",data.power.battChargeSource)),setParam("tempdevice",data.general.devTemperature+"°C"),setParam("tempbatt",data.power.batteryTemperature+"°C")}}})}function statusHeader(){document.body.insertAdjacentHTML("afterbegin",'<style>#mode,#rssi,#plmn,#band,#ca,#cellidhex,#cellid,#nb,#cc,#rnc,#psc,#enb,#cell,#pci,#rscp,#ecio,#rsrq,#rsrp,#sinr,#ul,#dl,#btlevel,#btsource,#tempdevice,#tempbatt{color:#b00;font-weight:strong;}.f{float:left;border:1px solid #bbb;border-radius:5px;padding:10px;line-height:2em;margin:5px;}.f ul{margin:0;padding:0;}.f ul li{display:inline;margin-right:10px;}</style><div style="display:block;overflow:auto;"><div class="f" id="status_general"><ul><li>Network mode:<span id="mode">#</span></li><li>RSSI:<span id="rssi">#</span></li></ul><ul><li>PLMN:<span id="plmn">#</span></li><li>Band:<span id="band">#</span><span id="castat">+<span id="ca">#</span>CA</span></li></ul><ul><li>Cell ID:<span id="cellidhex">#</span>/<span id="cellid">#</span></li></ul><ul id="u3g"><li>NB / Cell:<span id="nb">#</span>/<span id="cc">#</span></li><li>RNC-ID:<span id="rnc">#</span></li><li>SC:<span id="psc">#</span></li></ul><ul id="ulte"><li>eNB / Cell:<span id="enb">#</span>/<span id="cell">#</span></li><li id="lpci">PCI:<span id="pci">#</span></li></ul></div><div class="f" id="status_3g">RSCP:<span id="rscp">#</span><div id="brscp"></div>EC/IO:<span id="ecio">#</span><div id="becio"></div></div><div class="f" id="status_lte">RSRQ:<span id="rsrq">#</span><div id="brsrq"></div>RSRP:<span id="rsrp">#</span><div id="brsrp"></div>SINR:<span id="sinr">#</span><div id="bsinr"></div></div><div class="f" id="bandwidth"><ul><li>Download:<span id="dl">#</span></li><li>Upload:<span id="ul">#</span></li></ul><div id="bdlul"></div></div><div class="f" id="battery"><ul><li>Battery:<span id="btlevel">#</span></li><li>Charge:<span id="btsource">#</span></li></ul></div><div class="f"><ul><li>Temp</li><li>Device:<span id="tempdevice">#</span></li><li>Battery:<span id="tempbatt">#</span></li></ul></div></div>'),setInterval(currentBand,UPDATE_MS)}statusHeader();